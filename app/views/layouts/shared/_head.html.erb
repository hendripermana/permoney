<head>
  <title><%= full_title %></title>

  <meta charset="utf-8">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%# Critical viewport meta %>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">

  <%# Resource Hints for faster external connections %>
  <link rel="preconnect" href="https://cdn.plaid.com" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.plaid.com">
  
  <%# Preload critical assets %>
  <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload", media: "all" %>
  
  <%# Inline critical dark mode check to prevent FOUC (Flash of Unstyled Content) %>
  <%= render "layouts/dark_mode_check" %>

  <%# Defer non-critical JavaScript - load after HTML parsing %>
  <%= javascript_include_tag "https://cdn.plaid.com/link/v2/stable/link-initialize.js", defer: true, async: true %>
  
  <%# Combobox styles - can be loaded after critical styles %>
  <%= combobox_style_tag %>

  <%# Importmap with async loading for better performance %>
  <%= javascript_importmap_tags %>
  
  <%# Turbo configuration %>
  <%= turbo_refreshes_with method: :morph, scroll: :preserve %>

  <%# PWA Configuration %>
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Permoney">
  <meta name="msapplication-TileColor" content="#F9F9F9">
  <meta name="theme-color" content="#F9F9F9">

  <%# PWA Manifest and Icons %>
  <link rel="manifest" href="<%= pwa_manifest_path %>">
  <link rel="apple-touch-icon" href="/logo-pwa.png">
  <link rel="apple-touch-icon" sizes="512x512" href="/logo-pwa.png">

  <%= yield :head %>
</head>
