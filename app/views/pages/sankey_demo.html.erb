<% content_for :page_header do %>
  <div class="space-y-1 mb-6">
    <h1 class="text-xl lg:text-3xl font-medium text-primary">Responsive Sankey Chart Demo</h1>
    <p class="text-sm lg:text-base text-secondary">Demonstrating fluid auto-sizing across different container dimensions</p>
  </div>
<% end %>

<div class="w-full space-y-8 pb-24">
  <!-- Demo Data Setup -->
  <% 
    demo_sankey_data = {
      nodes: [
        { name: "Salary", value: 5000, percentage: 83.3, color: "var(--color-success)" },
        { name: "Freelance", value: 1000, percentage: 16.7, color: "var(--color-blue-500)" },
        { name: "Cash Flow", value: 6000, percentage: 0, color: "var(--color-success)" },
        { name: "Housing", value: 2000, percentage: 40.0, color: "var(--color-red-500)" },
        { name: "Food", value: 800, percentage: 16.0, color: "var(--color-orange-500)" },
        { name: "Transport", value: 400, percentage: 8.0, color: "var(--color-purple-500)" },
        { name: "Savings", value: 2800, percentage: 56.0, color: "var(--color-green-600)" }
      ],
      links: [
        { source: 0, target: 2, value: 5000, color: "var(--color-success)", percentage: 83.3 },
        { source: 1, target: 2, value: 1000, color: "var(--color-blue-500)", percentage: 16.7 },
        { source: 2, target: 3, value: 2000, color: "var(--color-red-500)", percentage: 40.0 },
        { source: 2, target: 4, value: 800, color: "var(--color-orange-500)", percentage: 16.0 },
        { source: 2, target: 5, value: 400, color: "var(--color-purple-500)", percentage: 8.0 },
        { source: 2, target: 6, value: 2800, color: "var(--color-green-600)", percentage: 56.0 }
      ],
      currency_symbol: "$"
    }
  %>

  <!-- Small Card Size (320x220) -->
  <section class="bg-container py-6 rounded-xl shadow-border-xs">
    <div class="px-6 mb-4">
      <h2 class="text-lg font-medium text-primary mb-2">Small Card (320Ã—220)</h2>
      <p class="text-sm text-secondary">Compact view for sidebars and small widgets</p>
    </div>
    
    <div class="px-6">
      <div class="w-80 h-56 border-2 border-dashed border-secondary rounded-lg">
        <div
          data-controller="sankey-autosizer"
          data-sankey-autosizer-min-width-value="320"
          data-sankey-autosizer-min-height-value="220"
          data-sankey-autosizer-max-width-value="320"
          data-sankey-autosizer-max-height-value="220"
          data-sankey-autosizer-debounce-ms-value="100"
          class="w-full h-full bg-container rounded-lg p-2">
          <div
            data-controller="sankey-chart"
            data-sankey-autosizer-target="chart"
            data-sankey-chart-data-value="<%= demo_sankey_data.to_json %>"
            data-sankey-chart-currency-symbol-value="$"
            class="w-full h-full"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Medium Panel Size (600x400) -->
  <section class="bg-container py-6 rounded-xl shadow-border-xs">
    <div class="px-6 mb-4">
      <h2 class="text-lg font-medium text-primary mb-2">Medium Panel (600Ã—400)</h2>
      <p class="text-sm text-secondary">Standard dashboard panel size</p>
    </div>
    
    <div class="px-6">
      <div class="w-full max-w-2xl h-96 border-2 border-dashed border-secondary rounded-lg mx-auto">
        <div
          data-controller="sankey-autosizer"
          data-sankey-autosizer-min-width-value="320"
          data-sankey-autosizer-min-height-value="220"
          data-sankey-autosizer-max-width-value="600"
          data-sankey-autosizer-max-height-value="400"
          data-sankey-autosizer-debounce-ms-value="100"
          class="w-full h-full bg-container rounded-lg p-4">
          <div
            data-controller="sankey-chart"
            data-sankey-autosizer-target="chart"
            data-sankey-chart-data-value="<%= demo_sankey_data.to_json %>"
            data-sankey-chart-currency-symbol-value="$"
            class="w-full h-full"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Large Desktop Size (1200x700) -->
  <section class="bg-container py-6 rounded-xl shadow-border-xs">
    <div class="px-6 mb-4">
      <h2 class="text-lg font-medium text-primary mb-2">Large Desktop (1200Ã—700)</h2>
      <p class="text-sm text-secondary">Full desktop dashboard view</p>
    </div>
    
    <div class="px-6">
      <div class="w-full h-96 lg:h-[700px] border-2 border-dashed border-secondary rounded-lg">
        <div
          data-controller="sankey-autosizer"
          data-sankey-autosizer-min-width-value="320"
          data-sankey-autosizer-min-height-value="220"
          data-sankey-autosizer-debounce-ms-value="100"
          class="w-full h-full bg-container rounded-lg p-6">
          <div
            data-controller="sankey-chart"
            data-sankey-autosizer-target="chart"
            data-sankey-chart-data-value="<%= demo_sankey_data.to_json %>"
            data-sankey-chart-currency-symbol-value="$"
            class="w-full h-full"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Fullscreen Demo -->
  <section class="bg-container py-6 rounded-xl shadow-border-xs">
    <div class="px-6 mb-4">
      <h2 class="text-lg font-medium text-primary mb-2">Fullscreen Mode</h2>
      <p class="text-sm text-secondary">Click the button below to test fullscreen responsiveness</p>
    </div>
    
    <div class="px-6">
      <div class="w-full h-64 border-2 border-dashed border-secondary rounded-lg relative">
        <div
          data-controller="sankey-autosizer cashflow-fullscreen-enhanced"
          data-sankey-autosizer-min-width-value="320"
          data-sankey-autosizer-min-height-value="220"
          data-sankey-autosizer-debounce-ms-value="100"
          data-cashflow-fullscreen-enhanced-sankey-data-value="<%= demo_sankey_data.to_json %>"
          data-cashflow-fullscreen-enhanced-currency-symbol-value="$"
          data-cashflow-fullscreen-enhanced-period-value="last_30_days"
          class="w-full h-full bg-container rounded-lg p-4">
          
          <!-- Fullscreen Button -->
          <button
            data-action="click->cashflow-fullscreen-enhanced#toggleFullscreen keydown->cashflow-fullscreen-enhanced#handleKeydown"
            class="absolute top-2 right-2 relative z-40 flex items-center justify-center w-10 h-10 rounded-lg border border-secondary bg-container hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors duration-200 group focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"
            title="Toggle fullscreen view"
            type="button"
            aria-label="Toggle fullscreen view"
            aria-pressed="false"
            tabindex="0">
            <svg class="w-5 h-5 text-secondary group-hover:text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
            </svg>
          </button>
          
          <div
            data-controller="sankey-chart"
            data-sankey-autosizer-target="chart"
            data-sankey-chart-data-value="<%= demo_sankey_data.to_json %>"
            data-sankey-chart-currency-symbol-value="$"
            class="w-full h-full"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Responsive Container Demo -->
  <section class="bg-container py-6 rounded-xl shadow-border-xs">
    <div class="px-6 mb-4">
      <h2 class="text-lg font-medium text-primary mb-2">Responsive Container</h2>
      <p class="text-sm text-secondary">Resize your browser window to see the chart adapt fluidly</p>
    </div>
    
    <div class="px-6">
      <div class="w-full" style="height: min(650px, max(400px, 50vh));">
        <div
          data-controller="sankey-autosizer"
          data-sankey-autosizer-min-width-value="320"
          data-sankey-autosizer-min-height-value="220"
          data-sankey-autosizer-debounce-ms-value="100"
          class="w-full h-full bg-container rounded-lg border border-secondary p-4">
          <div
            data-controller="sankey-chart"
            data-sankey-autosizer-target="chart"
            data-sankey-chart-data-value="<%= demo_sankey_data.to_json %>"
            data-sankey-chart-currency-symbol-value="$"
            class="w-full h-full"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Technical Details -->
  <section class="bg-container py-6 rounded-xl shadow-border-xs">
    <div class="px-6">
      <h2 class="text-lg font-medium text-primary mb-4">Implementation Features</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div class="space-y-2">
          <h3 class="font-medium text-primary">ğŸ”„ Auto-Sizing</h3>
          <p class="text-sm text-secondary">ResizeObserver-based container measurement with 100ms debouncing</p>
        </div>
        
        <div class="space-y-2">
          <h3 class="font-medium text-primary">ğŸ“ Dynamic Scaling</h3>
          <p class="text-sm text-secondary">Padding, fonts, and node sizes scale based on container dimensions</p>
        </div>
        
        <div class="space-y-2">
          <h3 class="font-medium text-primary">âœ‚ï¸ Smart Truncation</h3>
          <p class="text-sm text-secondary">Labels adapt to available space with tooltip fallbacks</p>
        </div>
        
        <div class="space-y-2">
          <h3 class="font-medium text-primary">ğŸŒ“ Theme Support</h3>
          <p class="text-sm text-secondary">Respects dark/light mode with CSS custom properties</p>
        </div>
        
        <div class="space-y-2">
          <h3 class="font-medium text-primary">âš¡ Performance</h3>
          <p class="text-sm text-secondary">No memory leaks, efficient rendering, batched updates</p>
        </div>
        
        <div class="space-y-2">
          <h3 class="font-medium text-primary">ğŸ”§ SSR Safe</h3>
          <p class="text-sm text-secondary">Guards against server-side rendering issues</p>
        </div>
      </div>
    </div>
  </section>
</div>