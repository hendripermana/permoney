<div data-controller="chat hotkey" class="h-[100dvh] lg:h-full flex flex-col">
  <%= turbo_frame_tag chat_frame do %>
    <%= turbo_stream_from @chat %>

    <h1 class="sr-only"><%= @chat.title %></h1>

    <div class="flex flex-col h-full min-h-0">
      <%# Header/Nav - Shrinks on mobile, full on desktop %>
      <div class="shrink-0 p-3 lg:p-4 border-b border-primary/10 lg:border-0 bg-surface">
        <%= render "chats/chat_nav", chat: @chat %>
      </div>

      <%# Messages Area - Takes remaining space, scrollable %>
      <div id="messages" 
           class="flex-1 overflow-y-auto overflow-x-hidden p-4 space-y-4 lg:space-y-6 scroll-smooth min-h-0" 
           data-chat-target="messages">
        <% if @chat.conversation_messages.any? %>
          <% @chat.conversation_messages.ordered.each do |message| %>
            <%= render message %>
          <% end %>
        <% else %>
          <div class="flex items-center justify-center h-full">
            <%= render "chats/ai_greeting", context: "chat" %>
          </div>
        <% end %>

        <% if params[:thinking].present? %>
          <%= render "chats/thinking_indicator", chat: @chat %>
        <% end %>

        <% if @chat.error.present? && @chat.needs_assistant_response? %>
          <%= render "chats/error", chat: @chat %>
        <% end %>
      </div>

      <%# Input Area - Fixed on mobile (above bottom nav), static on desktop %>
      <div class="shrink-0 p-3 lg:p-4 border-t border-primary/10 bg-surface 
                  fixed lg:static bottom-16 lg:bottom-auto left-0 right-0 
                  safe-area-inset-bottom">
        <%= render "messages/chat_form", chat: @chat, message: @message %>
      </div>
    </div>
  <% end %>
</div>
