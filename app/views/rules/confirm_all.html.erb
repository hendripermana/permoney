<%= render DS::Dialog.new do |dialog| %>
  <% dialog.with_header(title: "Apply all rules") %>

  <% dialog.with_body do %>
    <p class="text-secondary text-sm mb-4">
      You are about to apply <span class="text-primary font-medium"><%= @rules.count %> rule<%= "s" if @rules.count != 1 %></span>
      to <span class="text-primary font-medium"><%= @total_affected_count %> transaction<%= "s" if @total_affected_count != 1 %></span>
      that meet the specified criteria. Please confirm if you wish to proceed with this change.
    </p>

    <% if @rules.any? { |r| r.actions.any? { |a| a.action_type == "auto_categorize" } } %>
      <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
        <div class="flex items-start gap-2">
          <%= icon "info", class: "w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0" %>
          <div class="text-xs">
            <p class="font-medium text-blue-900 mb-1">AI Cost Estimation</p>
            <% if @estimated_cost.present? %>
              <p class="text-blue-700">
                This will use AI to categorize <%= @total_affected_count %> transaction<%= "s" if @total_affected_count != 1 %>.
                Estimated cost: <span class="font-semibold">~$<%= sprintf("%.4f", @estimated_cost) %></span>
              </p>
            <% else %>
              <p class="text-blue-700">
                This will use AI to categorize <%= @total_affected_count %> transaction<%= "s" if @total_affected_count != 1 %>.
                <% if @selected_model.present? %>
                  <span class="font-semibold">Cost estimation unavailable for model "<%= @selected_model %>".</span>
                <% else %>
                  <span class="font-semibold">Cost estimation unavailable (no LLM provider configured).</span>
                <% end %>
                You may incur costs, please check with the model provider for the most up-to-date prices.
              </p>
            <% end %>
            <p class="text-blue-600 mt-1">
              <%= link_to "View usage history", settings_llm_usage_path, class: "underline hover:text-blue-800" %>
            </p>
          </div>
        </div>
      </div>
    <% end %>

    <%= render DS::Button.new(
      text: "Apply all rules",
      href: apply_all_rules_path,
      method: :post,
      full_width: true,
      data: { turbo_frame: "_top" }) %>
  <% end %>
<% end %>
